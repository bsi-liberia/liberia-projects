{% set active_page='activity' %}{% extends "layout2.html" %}
{% block title %}{{ activity.title }}{% endblock %}
{% block content %}
<style>
  .table span.form-control-feedback {
    top: 0;
  }
</style>

<div class="row">
  <div class="col-md-12">
    <h1>{{ activity.title }}</h1>
  </div>
</div>
<div class="row">
  <div class="col-md-10">
    <p class="lead">{{ activity.description }}</p>
  </div>
  {% if activity.permissions.edit == True %}
  <div class="col-md-2">
    <a class="btn btn-success btn-large pull-right edit-project-button"
       href="{{ url_for('activities.activity_edit', activity_id=activity.id) }}">
      <i class="fas fa-edit"></i>
      {{ _('Edit project') }}
    </a>
  </div>
  {% endif %}
</div>
<div class="row">
  <div class="col-md-6">
    <h3>Basic data</h3>
    <table class="table table-hover table-sm" responsive>
      <tbody>
        <tr>
          <td><b>Project code</b></td>
          <td>{{ activity.code }}</td>
        </tr>
        <tr>
          <td><b>Project status</b></td>
          <td>
            <span class="badge badge-secondary">{{ codelist_lookups["ActivityStatus"][activity.activity_status] }}</span>
          </td>
        </tr>
        <tr>
          <td><b>Funded by</b></td>
          <td>{{ activity.reporting_org.name }}</td>
        </tr>
        <tr>
          <td><b>Implemented by</b></td>
          <td>{% for organisation in activity.implementing_organisations %}
            {{ organisation.name }}<br />
            {% endfor %}</td>
        </tr>
        <tr>
          <td><b>Start date</b></td>
          <td>{{ activity.start_date }}</td>
        </tr>
        <tr>
          <td><b>End date</b></td>
          <td>{{ activity.end_date }}</td>
        </tr>
        <tr>
          <td><b>Last updated</b></td>
          <td>{{ activity.updated_date }}</td>
        </tr>
      </tbody>
    </table>
    <h3>Sectors</h3>
    <table class="table table-hover table-sm" responsive>
      <tbody>
      {% for classification in activity.classification_data.values() %}
        <tr>
          <td><b>{{ classification.name }}</b></td>
          <td>
            {% for entry in classification["entries"] %}
            <span class="badge badge-secondary {{ classification.code }}-{{entry.codelist_code.code}}">{{ entry.codelist_code.name }}</span>
            {% endfor %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    {% if activity.milestones_data %}
    <h3>Milestones</h3>
    <table class="table table-hover table-sm" responsive>
      <tbody>
      {% for milestone in activity.milestones_data %}
        <tr>
          <td><b>{{milestone.name }}</b></td>
          <td><span class="glyphicon {{milestone.achieved.icon}}"></span> {{ milestone.achieved.name }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
  <div class="col-md-6" class="activity-profile-location-map-container">
    <h3 id="locations">Locations</h3>
    <div id="locationMap"></div>
  </div>
</div>
<div class="row">
  <div class="col">
    <hr />
  </div>
</div>
<div class="row" id="financialdata">
  <div class="col-md-12">
    <h2>Financial data</h3>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <h3>{% if activity.domestic_external == "external" %}Commitments{% else %}Appropriations{% endif %}</h3>
    <b-table class="table financial-table table-sm" id="commitments-table"
      :fields="fiscal_fields" :items="commitment_items"
      sort-by="period"
      sort-desc="true"
      responsive>
    </b-table>
  </div>
  {% if activity.FY_allotments_dict %}
  <div class="col-md">
    <h3>Allotments</h3>
    <b-table class="table financial-table table-sm" id="allotments-table"
      :fields="fiscal_fields" :items="allotment_items"
      sort-by="period"
      sort-desc="true"
      responsive>
    </b-table>
  </div>
  {% endif %}
  <div class="col-md">
    <h3>Disbursements</h3>
    <b-table class="table financial-table table-sm" id="disbursements-table"
      :fields="fiscal_fields" :items="disbursement_items"
      sort-by="period"
      sort-desc="true"
      responsive>
    </b-table>
  </div>
  {% if activity.FY_forward_spend_dict %}
  <div class="col-md">
    <h3>{% if activity.domestic_external == "external" %}MTEF Projections{% else %}Spending Plan{% endif %}</h3>
    <b-table class="table financial-table table-sm" id="mtef-projections-table"
      :fields="fiscal_fields" :items="forwardspend_items"
      sort-by="period"
      sort-desc="true"
      responsive>
    </b-table>
  </div>
  {% endif %}
</div>
<div class="row">
  <div class="col">
    <hr />
  </div>
</div>
{% if activity.results %}
<div class="row" id="results">
  <div class="col-md-12">
    <h2>{{ _('Results') }}</h2>
    <div class="alert alert-info">
      These results were automatically captured from <a href="http://d-portal.org/q.html?aid={{ activity.code }}">this donor's IATI data</a>.
    </div>
    <table class="table table-responsive">
      <thead>
        <th>Title</th>
        <th>From</th>
        <th>To</th>
        <th>Target</th>
        <th>Actual</th>
        <th width="30%">%</th>
      </thead>
      <tbody>
        {% for period in activity.result_indicator_periods %}
        <tr>
          <td>{{ period.result_indicator.indicator_title }}</a></td>
          <td>{{ period.period_start }}</a></td>
          <td>{{ period.period_end }}</a></td>
          <td>{{ period.target_value }}</a></td>
          <td>{{ period.actual_value }}</a></td>
          <td>
            {% if period.percent_complete != None %}
            <b-progress
              :value="{{ period.percent_complete }}" max="100"
              variant="{{ period.percent_complete_category }}"
              show-progress>
            </b-progress>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="row">
  <div class="col">
    <hr />
  </div>
</div>
{% endif %}
{% if activity.documents %}
<div class="row" id="documents">
  <div class="col-md-12">
    <h2>{{ _('Documents') }}</h2>
    <div class="alert alert-info">
      These documents were automatically captured from <a href="http://d-portal.org/q.html?aid={{ activity.code }}">this donor's IATI data</a>.
    </div>
    <table class="table table-responsive">
      <thead>
        <th width="50%">Title</th>
        <th>Type</th>
        <th>Date</th>
      </thead>
      <tbody>
        {% for document in activity.documents %}
        <tr>
          <td><a href="{{ document.url }}">{{ document.title }}</a></td>
          <td>
            {% for category_code in document.categories %}
            <span class="badge badge-secondary">{{ codelist_lookups["DocumentCategory"][category_code.code] }}</span>
            {% endfor %}
          </td>
          <td>{{ document.document_date or '' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}


<script type="text/javascript">
var api_locations_url = "{{ api_locations_url }}";
var api_activity_locations_url = "{{ api_activity_locations_url }}";
</script>

<link rel="stylesheet" href="{{url_for('static', filename='packages/leaflet/dist/leaflet.css')}}"/>
<script src="{{url_for('static', filename='packages/leaflet/dist/leaflet.js')}}"></script>
<script src="{{url_for('static', filename='js/map.js')}}" type="text/javascript"></script>
<script src="{{url_for('static', filename='packages/vue-scrollto/vue-scrollto.js')}}"></script>
{% endblock %}
{% block vuejs %}
<script type="text/javascript">
var disbursement_items = {{ activity.FY_disbursements_dict.values()|tojson }},
commitment_items = {{ activity.FY_commitments_dict.values()|tojson }},
allotment_items = {{ activity.FY_allotments_dict.values()|tojson }},
forwardspend_items = {{ activity.FY_forward_spend_dict.values()|tojson }}
</script>
<script src="{{url_for('static', filename='js/activity.js')}}" type="text/javascript"></script>
{% endblock %}